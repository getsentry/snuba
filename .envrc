#!/bin/bash
# shellcheck disable=SC1091

if [[ -f "${PWD}/.env" ]]; then
    dotenv
fi

if [ ! -d .venv ]; then
    echo "warning: creating virtualenv for the first time"
    if which pyenv > /dev/null; then
        eval "$(pyenv init -)"
        pyenv install -s
    else
        echo "warning: pyenv not installed, using python3 and hoping for the best"
    fi

    python3 -m venv .venv
    source .venv/bin/activate
    pip install $(grep ^-- requirements.txt) --upgrade pip==22.2.2 wheel==0.37.1
    make develop
else
    source .venv/bin/activate
    unset PS1
fi

PATH_add "${HOME}/.local/share/sentry-devenv/bin"

# devenv is currently only used for colima + devservices
# so we aren't requiring it at the moment

#if ! command -v devenv >/dev/null; then
#    echo "install devenv: https://github.com/getsentry/devenv#install"
#    return 1
#fi

PATH_add "${PWD}/.devenv/bin"

. scripts/rust-envvars
