#!/usr/bin/env bash

red="$(tput setaf 1)"
bold="$(tput bold)"
reset="$(tput sgr0)"


files_changed_upstream="$(mktemp)"
trap "rm -f ${files_changed_upstream}" EXIT

git diff-tree -r --name-only --no-commit-id ORIG_HEAD HEAD > "$files_changed_upstream"

grep -E --quiet 'migrations/groups.py' "$files_changed_upstream" && cat <<EOF

[${red}${bold}!!!${reset}] Some migrations have changed, you may need to run:

  snuba migrations migrate --force

EOF

grep -E --quiet 'requirements.txt' "$files_changed_upstream" && cat <<EOF

[${red}${bold}!!!${reset}] Python dependencies updated, you may need to run:

  make install-python-dependencies

EOF

grep -E --quiet 'rust_snuba/' "$files_changed_upstream" && cat <<EOF

[${red}${bold}!!!${reset}] Rust code changed, you may need to run:

  make install-rs-dev

EOF
